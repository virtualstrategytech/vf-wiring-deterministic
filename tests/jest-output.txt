PASS tests/llm_stub.test.js
  ΓùÅ Console

    console.log
      [2025-10-31T01:23:56.218Z] POST /webhook rid=no-request-id

      at novain-platform/webhook/server.js:181:11

    console.log
      webhook: action=llm_elicit name=Guest tenantId=default

      at novain-platform/webhook/server.js:270:11

    console.warn
      CI diagnostic: active handles after test cleanup (non-WriteStream): 2

      325 |             return;
      326 |           }
    > 327 |           console.warn(
          |                   ^
      328 |             'CI diagnostic: active handles after test cleanup (non-WriteStream):',
      329 |             meaningful.length
      330 |           );

      at tests/jest.setup.js:327:19

    console.warn
        handle[0] type=Socket

      333 |               try {
      334 |                 const name = h && h.constructor && h.constructor.name;
    > 335 |                 console.warn(`  handle[${i}] type=${String(name)}`);
          |                         ^
      336 |                 try {
      337 |                   if (h && typeof h._createdStack === 'string') {
      338 |                     const lines = h._createdStack

      at forEach (tests/jest.setup.js:335:25)
          at Array.forEach (<anonymous>)
      at tests/jest.setup.js:332:24

    console.warn
          socket-info: {"destroyed":false,"pending":false}

      354 |                       pending: h.pending,
      355 |                     };
    > 356 |                     console.warn(`    socket-info: ${JSON.stringify(info)}`);
          |                             ^
      357 |                   }
      358 |                 } catch {}
      359 |               } catch {}

      at forEach (tests/jest.setup.js:356:29)
          at Array.forEach (<anonymous>)
      at tests/jest.setup.js:332:24

    console.warn
        handle[1] type=Socket

      333 |               try {
      334 |                 const name = h && h.constructor && h.constructor.name;
    > 335 |                 console.warn(`  handle[${i}] type=${String(name)}`);
          |                         ^
      336 |                 try {
      337 |                   if (h && typeof h._createdStack === 'string') {
      338 |                     const lines = h._createdStack

      at forEach (tests/jest.setup.js:335:25)
          at Array.forEach (<anonymous>)
      at tests/jest.setup.js:332:24

    console.warn
          socket-info: {"destroyed":false,"pending":false}

      354 |                       pending: h.pending,
      355 |                     };
    > 356 |                     console.warn(`    socket-info: ${JSON.stringify(info)}`);
          |                             ^
      357 |                   }
      358 |                 } catch {}
      359 |               } catch {}

      at forEach (tests/jest.setup.js:356:29)
          at Array.forEach (<anonymous>)
      at tests/jest.setup.js:332:24

PASS tests/regression_raw_mirror.test.js
  ΓùÅ Console

    console.log
      [2025-10-31T01:23:57.214Z] POST /webhook rid=no-request-id

      at novain-platform/webhook/server.js:181:11

    console.log
      webhook: action=llm_elicit name=Guest tenantId=t

      at novain-platform/webhook/server.js:270:11

    console.log
      [2025-10-31T01:23:57.272Z] POST /webhook rid=no-request-id

      at novain-platform/webhook/server.js:181:11

    console.log
      webhook: action=invoke_component name=Guest tenantId=t

      at novain-platform/webhook/server.js:270:11

PASS tests/in_process.test.js
  ΓùÅ Console

    console.log
      [2025-10-31T01:23:57.809Z] POST /webhook rid=no-request-id

      at novain-platform/webhook/server.js:181:11

    console.log
      webhook: action=llm_elicit name=Guest tenantId=default

      at novain-platform/webhook/server.js:270:11

    console.log
      DEBUG resp.body: {"ok":true,"summary":"Please clarify X?","needs_clarify":false,"followup_question":"","raw":{"source":"stub"},"data":{"raw":{"source":"stub"}}}

      at Object.<anonymous> (tests/in_process.test.js:25:17)

PASS tests/debug_llm_logging.test.js
  ΓùÅ Console

    console.log
      RETRIEVAL_URL set: false

      at Object.<anonymous> (novain-platform/webhook/server.js:86:11)

    console.info
      PROMPT_URL set: true BUSINESS_URL set: false

      at Object.<anonymous> (novain-platform/webhook/server.js:87:11)

    console.info
      WEBHOOK_API_KEY present: true

      at Object.<anonymous> (novain-platform/webhook/server.js:89:11)

PASS tests/helpers/server-helper.test.js
PASS tests/webhook.inprocess.test.js
  ΓùÅ Console

    console.info
      DEBUG_TESTS: fetchFn present at module init? true

      at Object.<anonymous> (novain-platform/webhook/server.js:37:15)

    console.info
      SKIP_BODY_PARSER set ΓÇö using lightweight JSON body parser (test mode)

      at Object.<anonymous> (novain-platform/webhook/server.js:101:11)

    console.log
      [2025-10-31T01:23:59.745Z] GET /health rid=no-request-id

      at novain-platform/webhook/server.js:181:11

    console.info
      DEBUG_TESTS: fetchFn present at module init? true

      at Object.<anonymous> (novain-platform/webhook/server.js:37:15)

    console.info
      SKIP_BODY_PARSER set ΓÇö using lightweight JSON body parser (test mode)

      at Object.<anonymous> (novain-platform/webhook/server.js:101:11)

    console.log
      [2025-10-31T01:23:59.827Z] POST /webhook rid=no-request-id

      at novain-platform/webhook/server.js:181:11

    console.log
      webhook: action=ping name=Tester tenantId=default

      at novain-platform/webhook/server.js:270:11

    console.warn
      DEBUG: active handles summary:

      212 |       if (typeof process._getActiveHandles === 'function') {
      213 |         const handles = process._getActiveHandles() || [];
    > 214 |         console.warn('DEBUG: active handles summary:');
          |                 ^
      215 |         handles.forEach((h, i) => {
      216 |           try {
      217 |             const name = h && h.constructor && h.constructor.name;

      at tests/webhook.inprocess.test.js:214:17

    console.warn
      DEBUG: captured listen callbacks count = 0

      233 |     try {
      234 |       const cbs = global.__test_listen_callbacks || [];
    > 235 |       console.warn('DEBUG: captured listen callbacks count =', cbs.length);
          |               ^
      236 |       cbs.forEach((cb, idx) => {
      237 |         try {
      238 |           const stack =

      at tests/webhook.inprocess.test.js:235:15

PASS tests/webhook.smoke.test.js
  ΓùÅ Console

    console.warn
      DEBUG test-file loaded: webhook.smoke.test.js ts:2025-10-31T01:24:00.287Z

      29 | // non-secret (no env values printed).
      30 | try {
    > 31 |   console.warn(
         |           ^
      32 |     `DEBUG test-file loaded: ${path.basename(__filename)} ts:${new Date().toISOString()}`
      33 |   );
      34 | } catch {}

      at Object.<anonymous> (tests/webhook.smoke.test.js:31:11)

    console.error
      DEBUG test-file loaded: webhook.smoke.test.js ts:2025-10-31T01:24:00.289Z

      83 | function writeDebugLog(line) {
      84 |   try {
    > 85 |     console.error(line);
         |             ^
      86 |   } catch {}
      87 |   try {
      88 |     // best-effort: write to a temp file so CI artifact upload can collect it

      at writeDebugLog (tests/webhook.smoke.test.js:85:13)
      at Object.<anonymous> (tests/webhook.smoke.test.js:39:5)

PASS tests/hello.test.js

Test Suites: 8 passed, 8 total
Tests:       13 passed, 13 total
Snapshots:   0 total
Time:        6.653 s
Ran all test suites.

Jest has detected the following 2 open handles potentially keeping Jest from exiting:

  ΓùÅ  bound-anonymous-fn

      303 |
      304 |     try {
    > 305 |       server.listen(0, '127.0.0.1');
          |              ^
      306 |       server.once('listening', onListen);
      307 |     } catch {
      308 |       try {

      at tests/helpers/server-helper.js:305:14
      at Object.startTestServer (tests/helpers/server-helper.js:80:10)
      at requestApp (tests/helpers/request-helper.js:280:40)
      at Object.<anonymous> (tests/llm_stub.test.js:24:31)


  ΓùÅ  bound-anonymous-fn

      303 |
      304 |     try {
    > 305 |       server.listen(0, '127.0.0.1');
          |              ^
      306 |       server.once('listening', onListen);
      307 |     } catch {
      308 |       try {

      at tests/helpers/server-helper.js:305:14
      at Object.startTestServer (tests/helpers/server-helper.js:80:10)
      at requestApp (tests/helpers/request-helper.js:280:40)
      at Object.<anonymous> (tests/regression_raw_mirror.test.js:11:31)

